<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет</title>
</head>
<body>
    <h1>Личный кабинет</h1>
    <p>Добро пожаловать, {{ user.username }}!</p>

    <!-- Передаем user.id в JavaScript через data-атрибут -->
    <div id="userData" data-user-id="{{ user.id }}" style="display: none;"></div>

    <h2>Добавить заметку</h2>
    <form id="noteForm">
        <textarea id="noteContent" placeholder="Введите текст заметки" required></textarea>
        <button type="submit">Добавить</button>
    </form>

    <h2>Мои заметки</h2>
    <ul id="notesList">
        <!-- Заметки будут загружены здесь -->
    </ul>

    <script>
        // Получаем user.id из data-атрибута
        const userId = document.getElementById('userData').getAttribute('data-user-id');

        // Функция для загрузки заметок
        async function loadNotes() {
            const response = await fetch(`/api/profile/${userId}/notes`);
            const data = await response.json();
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = '';

            data.notes.forEach(note => {
                const li = document.createElement('li');
                li.textContent = note.content;
                notesList.appendChild(li);
            });
        }

        // Функция для добавления заметки
        document.getElementById('noteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = document.getElementById('noteContent').value;

            const response = await fetch(`/api/profile/${userId}/notes`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ content }),
            });

            if (response.ok) {
                document.getElementById('noteContent').value = '';
                loadNotes();
            }
        });

        // Загружаем заметки при загрузке страницы
        loadNotes();
    </script>
</body>
</html>